<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="ftw.statusmap">

  <head>
    <metal:javascriptslot fill-slot="javascript_head_slot">
      <script type="text/javascript" src="++resource++ftw.statusmap/statusmap.js"></script>
      <script type="text/javascript" tal:content="view/possible_transitions"></script>
    </metal:javascriptslot>

    <metal:cssslot fill-slot="css_slot">
      <link rel="stylesheet" type="text/css" media="screen" href="++resource++ftw.statusmap/statusmap.css" />
    </metal:cssslot>

    <metal:block fill-slot="column_two_slot"></metal:block>
  </head>

  <body>
    <metal:main fill-slot="main">

      <div metal:define-macro="main">
        <h1 class="documentFirstHeading" i18n:translate="label_workflow_map">Workflow Map</h1>
      </div>

      <form action="" method="POST" tal:define="transitions view/transitions;">

          <!-- ACTION -->
          <fieldset class="workflowmap_action" tal:condition="view/has_transitions">
              <legend i18n:translate="label_transition">Transition</legend>
                      <tal:repeat_transition
                              repeat="transition transitions">
                          <div tal:define="name python:transition.get('id');
                                           title python:view.get_transition_title(transition)"
                                  tal:attributes="class string:transition-${name}-colorized;">
                              <input type="radio"
                                      onclick="statusmap.selectTransition(this);"
                                      tal:attributes="value name;
                                                      id name;
                                                      name string:transition;
                                                      "/>
                              <label class="transitionLabel" tal:attributes="for name" tal:content="python:title" />
                          </div>
                      </tal:repeat_transition>
                      <br />
          </fieldset>

                      <!-- LISTING -->
            <table class="listing" summary="Content listing">
              <thead>
                <tr>
                  <th class="nosort" tal:condition="view/has_transitions">
                    <input type="checkbox" onclick="javascript:statusmap.toggleCheckboxes(this)" id="select_all" disabled="disabled" />
                  </th>
                  <th class="nosort" i18n:translate="label_title">Title</th>
                  <th class="nosort" i18n:translate="label_type">Type</th>
                  <th class="nosort" i18n:translate="label_status">Status</th>
                </tr>
              </thead>
              <tbody>
                 <tr tal:replace="structure view/render_status_map">Subtree</tr>
              </tbody>
          </table>

          <!-- COMMENT -->
          <tal:comment tal:condition="python: transitions">
            <div>
              <label for="comment" i18n:translate="label_comment">Comment</label>
            </div>
            <textarea name="comment" id="comment"></textarea>
            <input type="submit" name="submit" i18n:attributes="value label_change" value="Change" class="submit context" />
            <input type="submit" name="abort" i18n:attributes="value label_abort" value="Abort" class="standalone" />
          </tal:comment>

          <input type="hidden" name="form.submitted" value="1" />

          <tal:notransition tal:condition="python: not transitions">
            <input type="submit" name="back" i18n:attributes="value label_back" value="Back" class="standalone" />
          </tal:notransition>
      </form>

    </metal:main>
  </body>
</html>
